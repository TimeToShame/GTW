<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–±–æ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #333;
        }
        
        .back-button {
            background: none;
            border: none;
            color: #ff8c00;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            margin-right: 12px;
            width: auto;
        }
        
        .back-button:active {
            opacity: 0.6;
        }
        
        h1 {
            font-size: 24px;
            color: #ff8c00;
            font-weight: 700;
            flex: 1;
        }
        
        h2 {
            font-size: 22px;
            color: #ff8c00;
            margin-bottom: 20px;
            text-align: center;
        }
        
        h3 {
            color: #ff8c00;
            font-size: 18px;
            margin-bottom: 12px;
        }
        
        /* –°–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é */
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 40px;
        }
        
        .menu-button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            color: #ffffff;
            border: 2px solid #333;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            text-align: left;
        }
        
        .menu-button:hover {
            border-color: #ff8c00;
            background: linear-gradient(135deg, #333 0%, #2a2a2a 100%);
            transform: translateX(4px);
        }
        
        .menu-button:active {
            transform: scale(0.98);
        }
        
        .menu-button .icon {
            font-size: 28px;
        }
        
        .menu-button .text {
            flex: 1;
        }
        
        .menu-button .arrow {
            color: #ff8c00;
            font-size: 20px;
        }
        
        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #ffffff;
            font-size: 15px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #333;
            border-radius: 12px;
            font-size: 16px;
            background: #2a2a2a;
            color: #ffffff;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff8c00;
            background: #333;
        }
        
        select option {
            background: #2a2a2a;
            color: #ffffff;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        /* –í—ã–±–æ—Ä –¥—Ä—É–≥–∞ */
        .friend-selector {
            margin-bottom: 20px;
        }
        
        .friend-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        
        .friend-chip {
            padding: 10px 16px;
            background: #2a2a2a;
            border: 2px solid #333;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .friend-chip:hover {
            border-color: #ff8c00;
        }
        
        .friend-chip.selected {
            background: #ff8c00;
            border-color: #ff8c00;
            color: #1a1a1a;
            font-weight: 600;
        }
        
        .friend-chip.add-new {
            border-style: dashed;
            color: #ff8c00;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±—é–¥–∂–µ—Ç–∞ */
        .budget-container {
            margin-top: 10px;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #333;
        }
        
        .budget-input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }
        
        .budget-input-wrapper input[type="number"] {
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            color: #ff8c00;
            padding-right: 50px;
            background: #1a1a1a;
            border: 2px solid #ff8c00;
        }
        
        .budget-input-wrapper .currency {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            font-weight: 700;
            color: #ff8c00;
            pointer-events: none;
        }
        
        .budget-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #ff8c00 0%, #ff6600 100%);
            outline: none;
            padding: 0;
            border: none;
            box-shadow: 0 2px 10px rgba(255, 140, 0, 0.2);
            margin-bottom: 5px;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff8c00;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.5);
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.8);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff8c00;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.5);
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.8);
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        .date-selects {
            display: flex;
            gap: 10px;
        }
        
        .date-selects select {
            flex: 1;
        }
        
        button.primary-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ff8c00 0%, #ff6600 100%);
            color: #ffffff;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 24px;
            box-shadow: 0 4px 20px rgba(255, 140, 0, 0.3);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        button.primary-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 140, 0, 0.5);
        }
        
        button.primary-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 15px rgba(255, 140, 0, 0.3);
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –ª—é–¥–µ–π */
        .people-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .person-card {
            padding: 16px;
            background: #2a2a2a;
            border: 2px solid #333;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .person-card:hover {
            border-color: #ff8c00;
            background: #333;
            transform: translateX(4px);
        }
        
        .person-card:active {
            transform: scale(0.98);
        }
        
        .person-name {
            font-weight: 600;
            margin-bottom: 6px;
            color: #ff8c00;
            font-size: 18px;
        }
        
        .person-info {
            font-size: 14px;
            color: #999;
            margin-bottom: 4px;
        }
        
        .person-details {
            font-size: 13px;
            color: #666;
        }
        
        /* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state .icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        
        .empty-state h3 {
            color: #999;
            margin-bottom: 8px;
        }
        
        .empty-state p {
            font-size: 14px;
        }
        
        ::placeholder {
            color: #666;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #ff8c00;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #ff6600;
        }
        
        /* –°–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-form {
            display: none;
        }
        
        .profile-form.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <div id="homePage" class="page active">
            <h1 style="text-align: center; font-size: 32px; margin-bottom: 8px;">üéÅ WTG</h1>
            <p style="text-align: center; color: #999; margin-bottom: 40px;">What To Gift</p>
            
            <div class="menu-buttons">
                <button class="menu-button" onclick="showPage('giftPage')">
                    <span class="icon">üéÅ</span>
                    <span class="text">–ü–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫</span>
                    <span class="arrow">‚Üí</span>
                </button>
                
                <button class="menu-button" onclick="showPage('peoplePage')">
                    <span class="icon">üë•</span>
                    <span class="text">–ë–ª–∏–∑–∫–∏–µ</span>
                    <span class="arrow">‚Üí</span>
                </button>
                
                <button class="menu-button" onclick="showPage('wishlistPage')">
                    <span class="icon">‚≠ê</span>
                    <span class="text">–ú–æ–π –≤–∏—à-–ª–∏—Å—Ç</span>
                    <span class="arrow">‚Üí</span>
                </button>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–±–æ—Ä–∞ –ø–æ–¥–∞—Ä–∫–∞ -->
        <div id="giftPage" class="page">
            <div class="header">
                <button class="back-button" onclick="showPage('homePage')">‚Üê</button>
                <h1>–ü–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫</h1>
            </div>
            
            <!-- –í—ã–±–æ—Ä –¥—Ä—É–≥–∞ -->
            <div class="friend-selector">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                <div id="friendChips" class="friend-chips">
                    <div class="friend-chip add-new selected" onclick="selectFriend(null)">
                        + –ù–æ–≤—ã–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å
                    </div>
                </div>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è -->
            <div id="newPersonForm" class="profile-form active">
                <form id="giftForm">
                    <div class="form-group">
                        <label for="name">–ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                        <input type="text" id="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                    
                    <div class="form-group">
                        <label for="gender">–ü–æ–ª</label>
                        <select id="gender">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                            <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                            <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                        <div class="date-selects">
                            <select id="day">
                                <option value="">–î–µ–Ω—å</option>
                            </select>
                            <select id="month">
                                <option value="">–ú–µ—Å—è—Ü</option>
                            </select>
                            <select id="year">
                                <option value="">–ì–æ–¥</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="interests">–ò–Ω—Ç–µ—Ä–µ—Å—ã</label>
                        <textarea id="interests" placeholder="–û–ø–∏—à–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã —á–µ–ª–æ–≤–µ–∫–∞..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="event">–°–æ–±—ã—Ç–∏–µ</label>
                        <select id="event">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                            <option value="birthday">–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è</option>
                            <option value="new_year">–ù–æ–≤—ã–π –≥–æ–¥</option>
                            <option value="8march">8 –ú–∞—Ä—Ç–∞</option>
                            <option value="23february">23 –§–µ–≤—Ä–∞–ª—è</option>
                            <option value="anniversary">–ì–æ–¥–æ–≤—â–∏–Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π</option>
                            <option value="wedding">–°–≤–∞–¥—å–±–∞</option>
                            <option value="valentines">–î–µ–Ω—å –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞</option>
                            <option value="christmas">–†–æ–∂–¥–µ—Å—Ç–≤–æ</option>
                            <option value="housewarming">–ù–æ–≤–æ—Å–µ–ª—å–µ</option>
                            <option value="just_because">–ü—Ä–æ—Å—Ç–æ —Ç–∞–∫</option>
                            <option value="apology">–ò–∑–≤–∏–Ω–µ–Ω–∏–µ</option>
                            <option value="other">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="budget">–ë—é–¥–∂–µ—Ç</label>
                        <div class="budget-container">
                            <div class="budget-input-wrapper">
                                <input type="number" id="budgetInput" min="0" step="500" value="5000" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                                <span class="currency">‚ÇΩ</span>
                            </div>
                            <input type="range" id="budgetSlider" min="500" max="100000" step="500" value="5000">
                            <div class="budget-labels">
                                <span>500 ‚ÇΩ</span>
                                <span>100 000 ‚ÇΩ</span>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="primary-button">–ü–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫</button>
                </form>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –¥—Ä—É–≥–∞ -->
            <div id="existingPersonForm" class="profile-form">
                <div class="form-group">
                    <label for="eventExisting">–°–æ–±—ã—Ç–∏–µ</label>
                    <select id="eventExisting">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                        <option value="birthday">–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è</option>
                        <option value="new_year">–ù–æ–≤—ã–π –≥–æ–¥</option>
                        <option value="8march">8 –ú–∞—Ä—Ç–∞</option>
                        <option value="23february">23 –§–µ–≤—Ä–∞–ª—è</option>
                        <option value="anniversary">–ì–æ–¥–æ–≤—â–∏–Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π</option>
                        <option value="wedding">–°–≤–∞–¥—å–±–∞</option>
                        <option value="valentines">–î–µ–Ω—å –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞</option>
                        <option value="christmas">–†–æ–∂–¥–µ—Å—Ç–≤–æ</option>
                        <option value="housewarming">–ù–æ–≤–æ—Å–µ–ª—å–µ</option>
                        <option value="just_because">–ü—Ä–æ—Å—Ç–æ —Ç–∞–∫</option>
                        <option value="apology">–ò–∑–≤–∏–Ω–µ–Ω–∏–µ</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="budgetExisting">–ë—é–¥–∂–µ—Ç</label>
                    <div class="budget-container">
                        <div class="budget-input-wrapper">
                            <input type="number" id="budgetInputExisting" min="0" step="500" value="5000">
                            <span class="currency">‚ÇΩ</span>
                        </div>
                        <input type="range" id="budgetSliderExisting" min="500" max="100000" step="500" value="5000">
                        <div class="budget-labels">
                            <span>500 ‚ÇΩ</span>
                            <span>100 000 ‚ÇΩ</span>
                        </div>
                    </div>
                </div>
                
                <button class="primary-button" onclick="submitExistingPerson()">–ü–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫</button>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–ª–∏–∑–∫–∏—Ö -->
        <div id="peoplePage" class="page">
            <div class="header">
                <button class="back-button" onclick="showPage('homePage')">‚Üê</button>
                <h1>–ë–ª–∏–∑–∫–∏–µ</h1>
            </div>
            
            <div id="peopleList" class="people-list"></div>
            
            <div id="emptyPeople" class="empty-state">
                <div class="icon">üë•</div>
                <h3>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π</h3>
                <p>–î–æ–±–∞–≤—å—Ç–µ –±–ª–∏–∑–∫–∏—Ö —á–µ—Ä–µ–∑ "–ü–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫"</p>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–∏—à-–ª–∏—Å—Ç–∞ -->
        <div id="wishlistPage" class="page">
            <div class="header">
                <button class="back-button" onclick="showPage('homePage')">‚Üê</button>
                <h1>–ú–æ–π –≤–∏—à-–ª–∏—Å—Ç</h1>
            </div>
            
            <div class="empty-state">
                <div class="icon">‚≠ê</div>
                <h3>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –≤–∞—à –≤–∏—à-–ª–∏—Å—Ç</h3>
                <p>–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
            </div>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        let currentFriend = null;
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            if (pageId === 'peoplePage') {
                loadPeopleList();
            } else if (pageId === 'giftPage') {
                loadFriendChips();
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–Ω–µ–π
        const daySelect = document.getElementById('day');
        for (let i = 1; i <= 31; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            daySelect.appendChild(option);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Å—è—Ü–µ–≤
        const months = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                        '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
        const monthSelect = document.getElementById('month');
        months.forEach((month, index) => {
            const option = document.createElement('option');
            option.value = index + 1;
            option.textContent = month;
            monthSelect.appendChild(option);
        });
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ–¥–æ–≤
        const yearSelect = document.getElementById('year');
        const currentYear = new Date().getFullYear();
        for (let i = currentYear; i >= currentYear - 100; i--) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            yearSelect.appendChild(option);
        }
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±—é–¥–∂–µ—Ç–∞ (–Ω–æ–≤—ã–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å)
        const budgetSlider = document.getElementById('budgetSlider');
        const budgetInput = document.getElementById('budgetInput');
        
        budgetSlider.addEventListener('input', function() {
            budgetInput.value = this.value;
        });
        
        budgetInput.addEventListener('input', function() {
            let value = parseInt(this.value) || 0;
            if (value >= 500 && value <= 100000) {
                budgetSlider.value = value;
            }
        });
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±—é–¥–∂–µ—Ç–∞ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
        const budgetSliderExisting = document.getElementById('budgetSliderExisting');
        const budgetInputExisting = document.getElementById('budgetInputExisting');
        
        budgetSliderExisting.addEventListener('input', function() {
            budgetInputExisting.value = this.value;
        });
        
        budgetInputExisting.addEventListener('input', function() {
            let value = parseInt(this.value) || 0;
            if (value >= 500 && value <= 100000) {
                budgetSliderExisting.value = value;
            }
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —á–∏–ø—Å–æ–≤ –¥—Ä—É–∑–µ–π
        function loadFriendChips() {
            const saved = localStorage.getItem('savedPeople');
            const container = document.getElementById('friendChips');
            
            container.innerHTML = '<div class="friend-chip add-new" onclick="selectFriend(null)">+ –ù–æ–≤—ã–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å</div>';
            
            if (saved) {
                const people = JSON.parse(saved);
                people.forEach(person => {
                    const chip = document.createElement('div');
                    chip.className = 'friend-chip';
                    chip.textContent = person.name;
                    chip.onclick = () => selectFriend(person);
                    container.appendChild(chip);
                });
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π —á–∏–ø
            if (!currentFriend) {
                selectFriend(null);
            }
        }
        
        // –í—ã–±–æ—Ä –¥—Ä—É–≥–∞
        function selectFriend(person) {
            currentFriend = person;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∏–ø
            document.querySelectorAll('.friend-chip').forEach(chip => {
                chip.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Ñ–æ—Ä–º—É
            if (person === null) {
                document.getElementById('newPersonForm').classList.add('active');
                document.getElementById('existingPersonForm').classList.remove('active');
                clearNewPersonForm();
            } else {
                document.getElementById('newPersonForm').classList.remove('active');
                document.getElementById('existingPersonForm').classList.add('active');
                loadExistingPerson(person);
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã –Ω–æ–≤–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
        function clearNewPersonForm() {
            document.getElementById('name').value = '';
            document.getElementById('gender').value = '';
            document.getElementById('day').value = '';
            document.getElementById('month').value = '';
            document.getElementById('year').value = '';
            document.getElementById('interests').value = '';
            document.getElementById('event').value = '';
            document.getElementById('budgetInput').value = 5000;
            document.getElementById('budgetSlider').value = 5000;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
        function loadExistingPerson(person) {
            document.getElementById('eventExisting').value = person.event || '';
            const budget = person.budget || 5000;
            document.getElementById('budgetInputExisting').value = budget;
            if (budget >= 500 && budget <= 100000) {
                document.getElementById('budgetSliderExisting').value = budget;
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
        function submitExistingPerson() {
            const data = {
                ...currentFriend,
                event: document.getElementById('eventExisting').value,
                budget: document.getElementById('budgetInputExisting').value
            };
            
            tg.sendData(JSON.stringify(data));
            tg.close();
        }
        
        // –°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π
        function loadPeopleList() {
            const saved = localStorage.getItem('savedPeople');
            const listContainer = document.getElementById('peopleList');
            const emptyState = document.getElementById('emptyPeople');
            
            if (!saved || JSON.parse(saved).length === 0) {
                listContainer.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            const people = JSON.parse(saved);
            listContainer.innerHTML = '';
            
            people.forEach(person => {
                const card = document.createElement('div');
                card.className = 'person-card';
                
                const genderIcon = person.gender === 'male' ? 'üë®' : person.gender === 'female' ? 'üë©' : 'üë§';
                const age = person.age ? `${person.age} –ª–µ—Ç` : '–í–æ–∑—Ä–∞—Å—Ç –Ω–µ —É–∫–∞–∑–∞–Ω';
                const interests = person.interests ? person.interests.substring(0, 50) + '...' : '–ò–Ω—Ç–µ—Ä–µ—Å—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                
                card.innerHTML = `
                    <div class="person-name">${genderIcon} ${person.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</div>
                    <div class="person-info">${age}</div>
                    <div class="person-details">${interests}</div>
                `;
                
                card.onclick = () => {
                    showPage('giftPage');
                    setTimeout(() => selectFriend(person), 100);
                };
                
                listContainer.appendChild(card);
            });
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞
        function savePerson(data) {
            const saved = localStorage.getItem('savedPeople');
            let people = saved ? JSON.parse(saved) : [];
            
            if (data.birthdate) {
                const birthDate = new Date(data.birthdate);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                data.age = age;
            }
            
            const existingIndex = people.findIndex(p => p.name === data.name);
            if (existingIndex >= 0) {
                people[existingIndex] = data;
            } else {
                people.push(data);
            }
            
            localStorage.setItem('savedPeople', JSON.stringify(people));
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        loadFriendChips();
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('giftForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const day = document.getElementById('day').value;
            const month = document.getElementById('month').value;
            const year = document.getElementById('year').value;
            
            let birthdate = '';
            if (day && month && year) {
                birthdate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
            }
            
            const data = {
                name: document.getElementById('name').value,
                gender: document.getElementById('gender').value,
                birthdate: birthdate,
                interests: document.getElementById('interests').value,
                event: document.getElementById('event').value,
                budget: document.getElementById('budgetInput').value
            };
            
            if (data.name) {
                savePerson(data);
            }
            
            tg.sendData(JSON.stringify(data));
            tg.close();
        });
    </script>
</body>
</html>